# -*- mode: yaml -*-
# Config file for ReBench
default_experiment: all
default_data_file: 'benchmark.data'

reporting:
    # Benchmark results will be reported to ReBenchDB
    rebenchdb:
        # this url needs to point to the API endpoint
        db_url: https://rebench.stefan-marr.de/rebenchdb
        repo_url: https://github.com/smarr/truffleruby
        record_all: true # make sure everything is recorded
        project_name: TruffleRuby


# definition of benchmark suites
benchmark_suites:
    ruby-steady:
        gauge_adapter: RebenchLog
        location: awfy
        command: "harness.rb %(benchmark)s %(iterations)s "
        iterations: 150
        max_invocation_time: 6000
        min_iteration_time: 1
        benchmarks:
            - DeltaBlue:
                extra_args: 8000
            - Richards:
                extra_args: 15
            - Json:
                extra_args: 30
            - CD:
                extra_args: 100
            - Havlak:
                extra_args: 1
                variable_values: ["--vm.Xss5m"]
            
            - Bounce:
                extra_args: 1500
            - List:
                extra_args: 500
            - Mandelbrot:
                extra_args: 500
            - NBody:
                extra_args: 250000
            - Permute:
                extra_args: 500
            - Queens:
                extra_args: 300
            - Sieve:
                extra_args: 1000
            - Storage:
                extra_args: 300
            - Towers:
                extra_args: 200
                
            - LiquidCartParse:
                extra_args: 100
            - LiquidCartRender:
                extra_args: 300
            - LiquidMiddleware:
                extra_args: 2000
            - OptCarrot:
                extra_args: 5
            # - AsciidoctorConvert:
            #     extra_args: 1
            - AsciidoctorConvertSmall:
                extra_args: 1
            # - AsciidoctorLoadFile:
            #     extra_args: 1
            - AsciidoctorLoadFileSmall:
                extra_args: 1

    ruby-startup:
        gauge_adapter: RebenchLog
        location: awfy
        command: "harness.rb %(benchmark)s %(iterations)s "
        iterations: 1
        invocations: 5
        max_invocation_time: 6000
        min_iteration_time: 1
        benchmarks:
            - DeltaBlue:
                extra_args: 20
            - Richards:
                extra_args: 1
            - Json:
                extra_args: 1
            - CD:
                extra_args: 10
            
            - Bounce:
                extra_args: 5
            - List:
                extra_args: 7
            - Mandelbrot:
                extra_args: 50
            - NBody:
                extra_args: 250
            - Permute:
                extra_args: 1
            - Queens:
                extra_args: 1
            - Sieve:
                extra_args: 5
            - Storage:
                extra_args: 2
            - Towers:
                extra_args: 1
            
            - LiquidCartParse:
                extra_args: 1
            - LiquidCartRender:
                extra_args: 5
            - LiquidMiddleware:
                extra_args: 20
            - OptCarrot:
                extra_args: 1
            - AsciidoctorConvertSmall:
                extra_args: 1
            - AsciidoctorLoadFileSmall:
                extra_args: 1

    ruby-startup-larger:
        gauge_adapter: RebenchLog
        location: awfy
        command: "harness.rb %(benchmark)s %(iterations)s "
        iterations: 1
        invocations: 2
        max_invocation_time: 6000
        benchmarks:
          - Havlak:
              extra_args: 1
              variable_values: ["--vm.Xss5m"]
          - Activesupport:
              extra_args: 30
          # - AsciidoctorConvert:
          #     extra_args: 1
          # - AsciidoctorLoadFile:
          #     extra_args: 1
          

# VMs have a name and are specified by a path and the binary to be executed
executors:
    TruffleRuby-ce:
      path: ../bin
      executable: jt
      args: --use jvm-ce ruby %(variable)s

    TruffleRuby-ce-interp:
      path: ../bin
      executable: jt
      args: --use jvm-ce ruby %(variable)s --experimental-options --engine.Compilation=false

    TruffleRuby-jvm:
      path: ../bin
      executable: jt
      args: --use jvm ruby %(variable)s
    
    TruffleRuby-native:
      path: ../bin
      executable: jt
      args: --use native ruby 

    TruffleRuby-native-interp:
      path: ../bin
      executable: jt
      args: --use native ruby --experimental-options --engine.Compilation=false 

    
experiments:
    ruby-interp:
        description: Run Non-JITing Versions
        suites:
           - ruby-startup
           - ruby-startup-larger
        executions:
           - TruffleRuby-ce
           - TruffleRuby-ce-interp
           - TruffleRuby-jvm
           # - TruffleRuby-native
           - TruffleRuby-native-interp
    ruby-jit:
        description: Run JITing Versions
        suites:
           - ruby-steady
        executions:
           - TruffleRuby-ce
           # - TruffleRuby-native
